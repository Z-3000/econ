# 투자 데이터 분석 지침서

## 개요
이 문서는 `analysis.ipynb`의 분석 방법론과 근거를 정리한 지침서입니다.
분석 방향 수정 시 이 문서를 먼저 업데이트하고, 노트북에 반영하세요.

---

## 🔰 초심자를 위한 기본 용어 정리

분석을 이해하기 전에 알아야 할 핵심 용어들입니다.

### 수익률 관련
| 용어 | 설명 | 예시 |
|------|------|------|
| **단순수익률** | (오늘가격 - 어제가격) / 어제가격 | 1000원 → 1100원 = 10% |
| **로그수익률** | ln(오늘가격 / 어제가격) | 위와 같은 경우 ≈ 9.53% |
| **누적수익률** | 기간 전체의 총 수익률 | 1달간 15% 상승 |

**왜 로그수익률을 쓰나요?**
- 단순수익률은 +50% 후 -50%하면 원금이 아님 (100→150→75)
- 로그수익률은 더하기가 가능해서 계산이 편함
- 학술/금융업계 표준 방식

### 상관계수 관련
| 용어 | 설명 | 범위 |
|------|------|------|
| **상관계수** | 두 변수가 함께 움직이는 정도 | -1 ~ +1 |
| **롤링(Rolling)** | 일정 기간을 이동하며 계산 | 예: 7일씩 이동 |
| **피어슨 상관** | 선형 관계 측정 (가장 일반적) | -1 ~ +1 |

**상관계수 쉽게 이해하기:**
```
+1.0 : 완벽히 같이 움직임 (A↑ → B↑)
+0.5 : 대체로 같이 움직임
 0.0 : 관계 없음
-0.5 : 대체로 반대로 움직임
-1.0 : 완벽히 반대로 움직임 (A↑ → B↓)
```

### 기타 용어
| 용어 | 설명 |
|------|------|
| **변동성** | 가격이 얼마나 출렁이는지 (표준편차로 측정) |
| **VIX** | 공포지수, 시장의 불안감을 숫자로 표현 |
| **듀얼축** | 하나의 차트에 두 개의 Y축을 사용 |

---

## 분석 구조 및 흐름

### 전체 분석 흐름
```
┌─────────────────────────────────────────────────────────┐
│  1. 거시경제 (환율-코스피)                               │
│     → "큰 그림이 어떤가?" (숲을 보기)                    │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  2. 섹터/종목 분석 (반도체)                              │
│     → "구체적으로 어떤 종목이 좋은가?" (나무를 보기)      │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  3. 뉴스 트렌드                                         │
│     → "시장 분위기가 어떤가?" (심리 파악)                │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  4. 글로벌 연동성                                        │
│     → "해외 시장 영향은?" (외부 요인)                    │
└─────────────────────────────────────────────────────────┘
```

### 왜 이 순서인가?
1. **거시→미시**: 전체 경제 상황을 먼저 보고, 개별 종목을 봄
2. **숫자→심리**: 객관적 데이터 후 주관적 심리 지표 확인
3. **국내→해외**: 한국 시장 후 글로벌 영향도 확인

---

## Chart 1: 환율-코스피 듀얼축 + 롤링상관

### 🎯 이 차트가 필요한 이유
**실생활 비유**:
> 외국인이 한국 주식을 사려면 달러를 원화로 바꿔야 합니다.
> 환율이 1200원일 때 1달러로 살 수 있는 한국 주식과
> 환율이 1400원일 때 살 수 있는 주식의 양이 다릅니다.
> 따라서 환율 변동 → 외국인 투자 매력도 변화 → 주가 영향

### 분석 목적
- 환율과 주식시장의 관계 파악
- 외국인 자금 흐름 간접 추정
- 환율 급등 시 주식시장 대응 전략 수립

### 방법론
| 항목 | 현재 설정 | 변경 가능 옵션 | 변경 시 고려사항 |
|------|----------|----------------|------------------|
| 롤링 윈도우 | 7일 | 5일, 14일, 30일 | 짧으면 민감, 길면 안정적 |
| 상관계수 | 피어슨 | 스피어만, 켄달 | 비선형 관계 시 스피어만 |
| 환율 지표 | 원/달러 | 원/엔, 달러인덱스 | 일본 수출 비중 높으면 원/엔 |

### 이론적 근거
- **포트폴리오 밸런스 모델**: 환율 변동 → 외국인 투자 수익률 변화 → 자금 이동
- **Dornbusch & Fischer (1980)**: 환율-주가 상호작용 이론
- 한국 시장 특성: 외국인 비중 30%+ → 환율 민감도 높음

### 📊 차트 읽는 법
```
[상단 차트 - 듀얼축]
├── 파란선 (왼쪽 Y축): 코스피 지수
├── 빨간선 (오른쪽 Y축): 원/달러 환율
└── 두 선이 반대로 움직이면 → 역의 상관관계

[하단 차트 - 롤링상관]
├── 녹색 영역 (0 위): 양의 상관 (같이 움직임)
├── 빨간 영역 (0 아래): 음의 상관 (반대로 움직임)
└── 0에 가까우면: 관계가 약함
```

### 해석 기준
| 상관계수 | 해석 | 투자 시사점 |
|----------|------|-------------|
| -0.7 이하 | 강한 역의 관계 | 환율↑ 예상 시 주식 비중↓ 고려 |
| -0.3 ~ 0.3 | 약한 관계 | 환율보다 다른 요인이 중요 |
| 0.7 이상 | 강한 정의 관계 | 드문 경우, 특수 상황 점검 필요 |

### ⚠️ 주의사항 (자주 하는 실수)
1. **상관관계 ≠ 인과관계**: 환율과 주가가 같이 움직인다고 해서 환율이 주가를 "일으킨다"는 뜻 아님
2. **기간에 따라 달라짐**: 2020년과 2024년의 상관관계는 다를 수 있음
3. **다른 변수 무시 금지**: 금리, 경기, 정책 등 다른 요인도 고려해야 함

### 확장 가능 분석
- [x] 시차(lag) 상관분석: 환율이 주가를 선행하는지 ✅ **구현 완료**
- [x] 통계적 유의성 검정: p-value로 상관관계 유의성 확인 ✅ **구현 완료**
- [ ] Granger 인과관계 검정: 통계적으로 선후관계 검증
- [ ] 구조변화 시점 탐지: 관계가 바뀌는 시점 찾기 (예: 코로나 전후)

---

## Chart 2: 종목별 수익률 비교

### 🎯 이 차트가 필요한 이유
**실생활 비유**:
> 같은 "반도체"라도 삼성전자와 SK하이닉스는 다릅니다.
> 삼성전자는 메모리+파운드리+스마트폰, SK하이닉스는 메모리 집중.
> 같은 업종이라도 어떤 종목이 더 좋았는지 비교해야
> 다음에 어디에 투자할지 판단할 수 있습니다.

### 분석 목적
- 동일 섹터 내 종목 성과 비교
- 거래량과 가격 움직임 관계 파악
- 종목 선택 의사결정 지원

### 방법론
| 항목 | 현재 설정 | 변경 가능 옵션 | 변경 시 고려사항 |
|------|----------|----------------|------------------|
| 수익률 계산 | 로그수익률 | 단순수익률 | 학술용은 로그, 직관적 이해는 단순 |
| 비교 종목 | 삼성전자, SK하이닉스 | 다른 섹터/종목 | 동일 업종 비교가 의미있음 |
| 누적 방식 | 단순 누적 | 위험조정 수익률 | 변동성 고려하려면 샤프비율 |

### 이론적 근거
- **로그수익률 사용 이유**:
  - 시간 가산성: 일별 수익률을 더하면 = 기간 수익률
  - 정규분포에 더 가까움 → 통계 분석에 유리
  - 금융공학 표준 (Hull, 2018)
- **거래량 분석**:
  - 가격 상승 + 거래량 증가 = 강한 상승 신호
  - 가격 상승 + 거래량 감소 = 약한 상승, 조정 가능성

### 📊 차트 읽는 법
```
[상단 차트 - 누적수익률]
├── 0% 위: 수익 구간
├── 0% 아래: 손실 구간
├── 두 선의 간격: 성과 차이
└── 선이 벌어지면: 한쪽이 더 좋은 성과

[하단 차트 - 거래량]
├── 막대 높이: 해당 날 거래된 주식 수
├── 거래량 급증: 시장 관심 집중
└── 파랑(삼성) vs 빨강(SK) 비교
```

### 해석 기준
| 패턴 | 해석 | 의미 |
|------|------|------|
| A종목 수익률 > B종목 | A가 더 좋은 성과 | 단, 과거 성과가 미래 보장 X |
| 거래량 급증 + 가격↑ | 강한 매수세 | 추세 지속 가능성 |
| 거래량 급증 + 가격↓ | 강한 매도세 | 추가 하락 주의 |
| 변동성(출렁임) 차이 | 위험 수준 차이 | 출렁임 큰 종목 = 고위험 |

### ⚠️ 주의사항 (자주 하는 실수)
1. **과거 성과 ≠ 미래 성과**: 작년에 좋았다고 올해도 좋은 건 아님
2. **수익률만 보면 안됨**: 변동성(위험)도 함께 봐야 함
3. **기간 선택 편향**: 시작점을 어디로 잡느냐에 따라 결과 달라짐

### 확장 가능 분석
- [x] **샤프 비율**: (수익률 - 무위험수익률) / 변동성 ✅ **구현 완료**
- [x] **최대낙폭(MDD)**: 고점 대비 최대 손실률 ✅ **구현 완료**
- [x] **연환산 변동성**: 일별 변동성 → 연간 변동성 환산 ✅ **구현 완료**
- [ ] **베타**: 시장 대비 얼마나 민감한지 (베타 1.5 = 시장보다 1.5배 출렁임)

---

## Chart 3: 뉴스 키워드 빈도

### 🎯 이 차트가 필요한 이유
**실생활 비유**:
> 뉴스에서 "반도체"가 갑자기 많이 나오면?
> → 반도체 관련 이슈가 있다는 신호
> → 주가에 영향을 줄 수 있음
>
> 마치 SNS에서 특정 단어가 많이 언급되면
> 그게 "핫한 주제"인 것처럼, 뉴스도 마찬가지입니다.

### 분석 목적
- 시장 관심사 트렌드 파악
- 뉴스와 주가 움직임 연관성 탐색
- 시장 심리/분위기 간접 측정

### 방법론
| 항목 | 현재 설정 | 변경 가능 옵션 | 변경 시 고려사항 |
|------|----------|----------------|------------------|
| 키워드 | 경제, 부동산, 반도체, 코스피 | 사용자 정의 | 관심 분야에 맞게 조정 |
| 집계 단위 | 일간 | 주간, 월간 | 장기 트렌드는 주간/월간 |
| 분석 방식 | 빈도수 | TF-IDF, 감성점수 | 단순 빈도 → 중요도/감정 분석 |

### 이론적 근거
- **행동재무학 (Behavioral Finance)**:
  - 사람들은 합리적이지 않음, 감정에 영향받음
  - 뉴스 → 투자자 심리 → 매매 결정
  - Tetlock (2007): 부정적 뉴스 많으면 주가 하락 경향
- **대안 데이터 (Alternative Data)**:
  - 전통적 데이터(가격, 재무제표) 외의 정보
  - 최근 퀀트 투자에서 뉴스/SNS 데이터 활용 증가

### 📊 차트 읽는 법
```
[뉴스 빈도 차트]
├── Y축: 해당 날 기사 수
├── 각 색상: 키워드별 구분
├── 급등하는 구간: 해당 주제 이슈 발생
└── 여러 키워드 동시 급증: 큰 시장 이벤트
```

### 해석 기준
| 패턴 | 해석 | 행동 제안 |
|------|------|-----------|
| 특정 키워드 급증 | 해당 분야 이슈 발생 | 관련 뉴스 상세 확인 |
| 경제 키워드 지속↑ | 거시경제 불확실성 | 보수적 투자 고려 |
| 반도체 키워드 급증 | 섹터 모멘텀 가능성 | 해당 종목 분석 |
| 전체적으로 조용함 | 시장 무관심/안정 | 큰 변동 없을 가능성 |

### ⚠️ 주의사항 (자주 하는 실수)
1. **빈도 ≠ 중요도**: 많이 나왔다고 중요한 건 아님
2. **긍정/부정 구분 안됨**: 현재는 빈도만 세서, "좋은 뉴스"인지 "나쁜 뉴스"인지 모름
3. **뉴스 선행 vs 후행**: 뉴스가 주가를 예측하는지, 주가 변동 후 뉴스가 나오는지 구분 필요

### 확장 가능 분석
- [x] **감성분석**: 키워드 기반 긍정/부정 분류 ✅ **구현 완료**
- [x] **감성-수익률 상관**: 뉴스 감성과 코스피 수익률 관계 분석 ✅ **구현 완료**
- [ ] **선행 관계 검정**: 뉴스 감성 변화 → N일 후 주가 변동?
- [ ] **토픽 모델링 (LDA)**: 키워드를 직접 지정하지 않고 자동 추출
- [ ] **딥러닝 감성분석**: KoBERT 등 사전학습 모델 활용

---

## Chart 4: 미국-한국 상관분석

### 🎯 이 차트가 필요한 이유
**실생활 비유**:
> "미국이 기침하면 한국은 감기 걸린다"는 말이 있습니다.
> 미국 증시가 하락하면 다음날 한국 증시도 하락하는 경우가 많죠.
> 이 관계가 얼마나 강한지를 숫자로 보여주는 게 이 차트입니다.
>
> 또한, 여러 시장에 분산투자할 때
> 서로 상관관계가 낮아야 "달걀을 여러 바구니에 나눠 담는" 효과가 있습니다.

### 분석 목적
- 글로벌 시장 연동성 파악
- 분산투자 효과 측정
- 해외 시장 변동이 국내에 미치는 영향 예측

### 방법론
| 항목 | 현재 설정 | 변경 가능 옵션 | 변경 시 고려사항 |
|------|----------|----------------|------------------|
| 상관계수 | 피어슨 | 스피어만 | 비선형 관계 의심 시 스피어만 |
| 분석 대상 | 5개 지수 | 다른 지수 추가 | 유럽(DAX), 중국(상해) 등 |
| 시각화 | 히트맵 (하삼각) | 전체 행렬, 클러스터맵 | 그룹화 보려면 클러스터맵 |

### 분석 대상 지수 설명
| 지수 | 설명 | 특징 |
|------|------|------|
| 코스피 | 한국 대형주 | 삼성전자 비중 높음 |
| 코스닥 | 한국 중소형/기술주 | 바이오, IT 비중 높음 |
| S&P500 | 미국 대형주 500개 | 가장 대표적인 미국 지수 |
| 나스닥 | 미국 기술주 중심 | 애플, 테슬라, 엔비디아 등 |
| VIX | 공포지수 | 불안할수록 높아짐 |

### 이론적 근거
- **현대 포트폴리오 이론 (MPT)**:
  - Markowitz (1952), 노벨 경제학상 수상
  - 핵심: 상관관계 낮은 자산을 섞으면 위험 감소
- **VIX (공포지수)**:
  - S&P500 옵션 가격에서 계산
  - 시장 참여자들이 예상하는 "향후 변동성"
  - 보통 20 이하 = 안정, 30 이상 = 불안

### 📊 차트 읽는 법 (히트맵)
```
[상관계수 히트맵]
├── 각 칸의 숫자: 두 지수 간 상관계수
├── 색상 (빨강): 양의 상관 (같이 움직임)
├── 색상 (파랑): 음의 상관 (반대로 움직임)
├── 색이 진할수록: 관계가 강함
└── 대각선: 자기 자신과의 상관 = 1.00 (당연)
```

**예시 해석**:
- 코스피-나스닥 = 0.65 → 나스닥 오르면 코스피도 오를 확률 높음
- VIX-S&P500 = -0.70 → VIX 오르면 S&P500 내릴 확률 높음

### 해석 기준
| 상관계수 | 해석 | 분산투자 관점 |
|----------|------|---------------|
| 0.7 이상 | 강한 연동 | 분산효과 낮음 (같이 떨어짐) |
| 0.3 ~ 0.7 | 중간 연동 | 어느 정도 분산효과 |
| 0.3 이하 | 약한 연동 | 분산효과 높음 |
| 음수 | 반대로 움직임 | 헷지(위험 회피) 가능 |

### ⚠️ 주의사항 (자주 하는 실수)
1. **위기 시 상관관계 급등**: 평소엔 낮아도 폭락장에선 다 같이 떨어짐
2. **시차 무시**: 미국 장 마감 → 한국 장 개장 (시간차 있음)
3. **환율 효과 무시**: 원화 기준 수익률 vs 달러 기준 수익률 다름

### 확장 가능 분석
- [ ] **롤링 상관**: 상관관계가 시간에 따라 어떻게 변하는지
- [ ] **위기 시 분석**: 2008년, 2020년 등 위기 시 상관관계 변화
- [ ] **공적분 검정**: 장기적으로 함께 움직이는 균형관계가 있는지

---

## 🎓 분석 수준 및 한계

### 현재 분석 수준
```
┌─────────────────────────────────────────────────────────┐
│  📊 탐색적 데이터 분석 (EDA) + 통계 검정                │
│  ├── 목적: 패턴 발견, 가설 수립 + 유의성 확인           │
│  ├── 방법: 시각화 + p-value 검정                        │
│  └── 보완: 시차분석, 위험지표, 감성분석 추가            │
└─────────────────────────────────────────────────────────┘
```

### 분석 수준 단계 (학습 로드맵)

| 단계 | 수준 | 포함 내용 | 현재 위치 |
|------|------|----------|-----------|
| 1 | 기초 EDA | 시각화, 기술통계 | ✅ 완료 |
| 2 | 통계 검정 | t-test, 상관관계 유의성 | ✅ 현재 (보완됨) |
| 3 | 시계열 분석 | ARIMA, 계절성, 추세 | 다음 목표 |
| 4 | 인과관계 | Granger, VAR 모델 | 고급 |
| 5 | 머신러닝 | 예측 모델, 분류 | 심화 |

### 학술 논문 수준으로 발전 시 추가 필요 사항
| 항목 | 설명 | 예시 |
|------|------|------|
| 통계적 유의성 | p-value < 0.05 확인 | "상관계수 0.65, p<0.01" |
| 신뢰구간 | 추정치의 범위 제시 | "95% CI: [0.55, 0.75]" |
| 인과관계 검정 | 단순 상관이 아닌 원인-결과 | Granger causality |
| 강건성 검증 | 조건 바꿔도 결과 일관? | 기간/샘플 변경 테스트 |
| 외생변수 통제 | 다른 영향 요인 고려 | 회귀분석에서 통제변수 |

---

## 📚 참고 문헌 및 학습 자료

### 이론적 배경 (학술 논문)
| 저자 | 연도 | 제목 | 핵심 내용 |
|------|------|------|----------|
| Markowitz | 1952 | Portfolio Selection | 분산투자 이론의 시작 |
| Fama | 1970 | Efficient Capital Markets | 효율적 시장 가설 |
| Dornbusch & Fischer | 1980 | Exchange Rates | 환율-주가 관계 |
| Tetlock | 2007 | Investor Sentiment | 뉴스와 주가 관계 |
| Baker & Wurgler | 2006 | Investor Sentiment | 투자자 심리 측정 |

### 입문자 추천 학습 자료
| 분야 | 추천 자료 | 비고 |
|------|----------|------|
| 투자 기초 | 《주식투자 무작정 따라하기》 | 한국어, 입문 |
| 파이썬 금융 | 《파이썬으로 배우는 금융 분석》 | 코드 포함 |
| 통계 기초 | Khan Academy 통계학 | 무료, 영상 |
| 포트폴리오 | CFA Level 1 자료 | 체계적, 영어 |

### 실무 참고
- Hull, J. C. (2018). *Options, Futures, and Other Derivatives*
- CFA Institute. *CFA Program Curriculum*

---

## 📝 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|----------|--------|
| 2025-12-02 | 최초 작성 (초심자용 보완 버전) | Claude Code |
| 2025-12-02 | 분석 보완: 통계검정, 시차분석, 위험지표, 감성분석 추가 | Claude Code |

---

## 💡 이 파일 사용 방법

### 기본 사용법
이 파일은 자동 인식되지 않습니다. 분석 수정이 필요할 때:
```
"ANALYSIS_GUIDE.md 참고해서 분석 방법 바꿔줘"
"롤링 윈도우 14일로 변경하고 싶어"
```

### 분석 수정 워크플로우
```
1. 이 문서에서 "변경 가능 옵션" 확인
2. 원하는 변경 사항 결정
3. Claude에게 변경 요청
4. analysis.ipynb 수정
5. 이 문서의 "현재 설정" 업데이트
6. 변경 이력에 기록
```

### 새로운 분석 추가 시
```
1. "확장 가능 분석" 체크리스트에서 선택
2. 또는 새로운 분석 아이디어 제안
3. 이론적 근거 함께 정리
4. 이 문서에 새 섹션 추가
```

---

## 📈 Historical 데이터 사용 가이드

### 데이터 현황 (2025-12-02 기준)

| 데이터 | 파일 | 레코드 | 기간 |
|--------|------|--------|------|
| 주가 | stock_historical.csv | 19,124건 | 2020-01-02 ~ 현재 |
| 경제지표 | economy_historical.csv | 4,447건 | 2020-01 ~ 현재 |

### 5년치 데이터의 장점
1. **통계적 유의성**: 충분한 샘플 수로 신뢰도 높은 분석
2. **경기 사이클 포착**: 코로나(2020), 금리인상(2022) 등 이벤트 포함
3. **롤링 계산 안정화**: 20일, 60일 롤링도 초기 결측 최소화

### 분석 시 고려사항

#### 구조 변화 시점
| 시점 | 이벤트 | 영향 |
|------|--------|------|
| 2020-03 | 코로나 폭락 | 상관관계 급변 |
| 2022-03 | 금리인상 시작 | 채권-주식 관계 변화 |
| 2024-01 | AI 랠리 | 기술주 급등 |

#### 기간별 분석 권장
```python
# 전체 기간 분석
df_full = df[df['date'] >= '2020-01-01']

# 코로나 이후 정상화 기간
df_post_covid = df[df['date'] >= '2021-01-01']

# 최근 1년
df_recent = df[df['date'] >= '2024-01-01']
```

### 변경 이력
| 날짜 | 변경 내용 |
|------|----------|
| 2025-12-02 | Historical 데이터 가이드 추가 |

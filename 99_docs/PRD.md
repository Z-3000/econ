# PRD: 투자 데이터 분석 시스템

## 1. 개요

### 1.1 프로젝트명
**Investment Data Analytics Platform (IDAP)**

### 1.2 목적
- 주식/펀드 투자 의사결정 지원
- 뉴스, 주가, 경제지표 통합 분석
- 데이터 기반 인사이트 도출

### 1.3 배경
- 수동 정보 수집의 비효율성
- 분산된 데이터 소스 통합 필요
- 정량적 분석 기반 투자 판단 필요

---

## 2. 사용자

### 2.1 주요 사용자
- **개인 투자자** (본인): 주식/펀드 투자 분석

### 2.2 사용자 니즈
| 니즈 | 설명 |
|------|------|
| 정보 통합 | 뉴스, 주가, 경제지표를 한 곳에서 확인 |
| 트렌드 파악 | 시장 흐름 및 상관관계 분석 |
| 시그널 탐지 | 매수/매도 타이밍 힌트 |
| 감성 분석 | 뉴스 기반 시장 심리 파악 |

---

## 3. 기능 요구사항

### 3.1 Phase 1: 데이터 전처리 (MVP)

| ID | 기능 | 우선순위 | 상태 |
|----|------|----------|------|
| F1.1 | 데이터 정제 (HTML 제거, 타임존 통일) | P0 | 완료 |
| F1.2 | 중복 데이터 제거 | P0 | 완료 |
| F1.3 | 파생 컬럼 생성 (수익률, 변동성) | P0 | 완료 |
| F1.4 | 이벤트 플래그 태깅 | P1 | 예정 |
| F1.5 | 과거 5년 데이터 수집 (주가/경제지표) | P0 | 완료 |

#### 상세 요구사항

**F1.1 데이터 정제**
- news.csv: HTML 태그(`<b>` 등) 제거
- 모든 timestamp: Asia/Seoul (KST) 통일
- stock.csv: 장마감(15:30) 기준 리샘플

**F1.2 중복 제거**
- stock: 일자별 마지막 레코드만 유지
- news: 제목 유사도(Jaccard>0.8) + 1시간 이내 → 중복 처리

**F1.3 파생 컬럼**
```
stock:
- log_return: 로그 수익률
- volatility_20d: 20일 변동성 (연율화)
- volume_zscore: 거래량 이상치 탐지용

economy:
- pct_1d, pct_1w, pct_1m: 변동률
- is_holiday_gap: 휴일 갭 플래그

news:
- session: 장전(pre)/장중(regular)/장후(post)
```

**F1.4 이벤트 플래그**
- event_flag 컬럼: rate_decision, cpi_release, fomc 등

---

### 3.2 Phase 2: 시각화

| ID | 기능 | 우선순위 | 상태 |
|----|------|----------|------|
| F2.1 | 환율-코스피 듀얼축 차트 | P0 | 예정 |
| F2.2 | 30일 롤링 상관계수 플롯 | P0 | 예정 |
| F2.3 | 종목별 수익률 비교 차트 | P1 | 예정 |
| F2.4 | 뉴스 키워드 빈도 추이 | P1 | 예정 |
| F2.5 | Streamlit 대시보드 | P2 | 예정 |

#### 상세 요구사항

**F2.1 환율-코스피 듀얼축**
- 좌축: 코스피 지수
- 우축: 원/달러 환율
- 이벤트 마커 표시 (금리결정일 등)

**F2.2 롤링 상관계수**
- 환율 vs 코스피 30일 롤링 상관
- -1~1 범위, 0선 기준선 표시

**F2.3 수익률 비교**
- 삼성전자 vs SK하이닉스 누적수익률
- 거래량 바 차트 (하단)

**F2.4 뉴스 빈도**
- 키워드별(경제/부동산/반도체/코스피) 일간 기사 수
- 스택 영역 차트

---

### 3.3 Phase 3: 감성분석

| ID | 기능 | 우선순위 | 상태 |
|----|------|----------|------|
| F3.1 | 금융 도메인 사전 구축 | P0 | 예정 |
| F3.2 | 사전 기반 감성 점수 계산 | P0 | 예정 |
| F3.3 | 세션별 감성 집계 | P1 | 예정 |
| F3.4 | 감성-주가 상관 분석 | P1 | 예정 |
| F3.5 | BERT 모델 적용 (선택) | P2 | 예정 |

#### 상세 요구사항

**F3.1 금융 도메인 사전**
```
긍정: 상승, 호실적, 상향, 완화, 개선, 흑자, 성장, 반등
부정: 하락, 적자, 하향, 긴축, 악화, 급락, 위기, 우려
```
- 30~50개 핵심 단어
- 점수: 긍정(+1), 부정(-1), 중립(0)

**F3.2 감성 점수**
- 뉴스 제목/설명에서 키워드 카운트
- 점수 = (긍정 - 부정) / 전체

**F3.3 세션별 집계**
- 장전/장중/장후별 평균 감성
- 7일/30일 롤링 평균

---

### 3.4 Phase 4: 고급 분석 (선택)

| ID | 기능 | 우선순위 | 상태 |
|----|------|----------|------|
| F4.1 | 이벤트 스터디 (±5일 수익률) | P2 | 예정 |
| F4.2 | 외국인/기관 수급 연동 | P2 | 예정 |
| F4.3 | 미국 지수 추가 (S&P500, VIX) | P2 | 예정 |
| F4.4 | 알림 시스템 | P3 | 예정 |

---

## 4. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 데이터 무결성 | 원본 00_data_raw/ 폴더 수정 금지 |
| 백업 | 00-1_data_processed/ 별도 저장 |
| 보안 | API 키 환경변수 관리 (.env) |
| 성능 | 일간 데이터 처리 < 1분 |
| 확장성 | 새 지표/종목 추가 용이 |

---

## 5. 데이터 소스

| 소스 | 데이터 | 수집 주기 |
|------|--------|-----------|
| 네이버 검색 API | 뉴스 (경제/부동산/반도체/코스피) | 실시간 |
| yfinance | 주가 (코스피, 코스닥, 개별종목) | 일간 |
| 한국은행 ECOS | 환율, 금리, 유가, 금시세 | 일간 |

### 향후 추가 예정
- KRX: 외국인/기관 수급
- FRED: 미국 경제지표
- Twitter/X: 소셜 감성

---

## 6. 기술 스택

| 영역 | 기술 |
|------|------|
| 언어 | Python 3.12 |
| 데이터 처리 | pandas, numpy |
| 시각화 | matplotlib, seaborn, plotly, mplfinance |
| 대시보드 | Streamlit |
| NLP | konlpy, transformers (선택) |
| 스케줄링 | cron (라즈베리파이) |

---

## 7. 마일스톤

| Phase | 목표 | 산출물 |
|-------|------|--------|
| Phase 1 | 데이터 전처리 | preprocessor.py, 정제된 CSV |
| Phase 2 | 시각화 | analysis.ipynb, 차트 이미지 |
| Phase 3 | 감성분석 | sentiment.py, 감성 데이터 |
| Phase 4 | 고급 분석 | dashboard (Streamlit) |

---

## 8. 제약사항

| 항목 | 내용 |
|------|------|
| API 한도 | 네이버: 일 25,000건 |
| 데이터 지연 | yfinance: 실시간 아님 (15분 지연) |
| 하드웨어 | 라즈베리파이 (저사양) |
| 시간 | 개인 프로젝트, 유연한 일정 |

---

## 9. 성공 지표

| 지표 | 목표 |
|------|------|
| 데이터 수집 안정성 | 일간 수집 성공률 > 95% |
| 분석 커버리지 | 주요 지표 5개 이상 시각화 |
| 인사이트 활용 | 월 1회 이상 투자 의사결정 참고 |

---

## 10. 리스크

| 리스크 | 영향 | 대응 |
|--------|------|------|
| API 변경/중단 | 데이터 수집 불가 | 대체 소스 확보 |
| 데이터 품질 저하 | 분석 신뢰도 하락 | 검증 로직 추가 |
| 과적합 | 잘못된 투자 판단 | 백테스트 필수 |

---

## 부록: 용어 정의

| 용어 | 설명 |
|------|------|
| 로그 수익률 | ln(P_t / P_{t-1}), 복리 수익률 계산에 적합 |
| 변동성 | 수익률의 표준편차, 연율화(×√252) |
| 롤링 상관 | 이동 윈도우 기반 상관계수 |
| 감성 점수 | 텍스트의 긍정/부정 정도 (-1 ~ +1) |

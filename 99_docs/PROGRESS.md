# 프로젝트 진행 현황 및 로드맵

> 마지막 업데이트: 2025-12-07

---

## 1. 프로젝트 개요

### 목적
- 주식/펀드 투자 의사결정을 위한 데이터 분석 시스템 구축
- 뉴스, 주가, 경제지표 통합 수집 및 분석
- **InfluxDB + Grafana 기반 상시 모니터링 시스템 구축**
- **자동화된 운영 모니터링 (Telegram 알림, 시스템 헬스)**

### 현재 상태
- **Status**: Phase 2.7 완료 (운영 기능 강화)
- **다음**: Phase 3 감성분석 또는 Grafana 대시보드 고급 기능

### 수집 스케줄
| 시간 | 수집 항목 |
|------|-----------|
| 08:00 | 미국 주가 + 경제지표 + 뉴스 |
| 16:00 | 한국 주가 + 경제지표 + 뉴스 (평일) |
| 20:00 | 경제지표 + 뉴스 |

---

## 2. Phase별 진행 현황

### 완료된 Phase

| Phase | 목표 | 상태 | 완료일 |
|-------|------|------|--------|
| Phase 1 | 데이터 전처리 | ✅ 완료 | 2025-11-30 |
| Phase 2 | 시각화 (Streamlit, 노트북) | ✅ 완료 | 2025-11-30 |
| Phase 2.5 | InfluxDB + Grafana 모니터링 | ✅ 완료 | 2025-12-03 |
| Phase 2.6 | 대시보드 고도화 (정규화) | ✅ 완료 | 2025-12-04 |
| Phase 2.7 | 운영 기능 강화 | ✅ 완료 | 2025-12-07 |

### Phase 2.7 완료 내역 (2025-12-07)
```
운영 기능 강화 완료
├── 1. Telegram 알림 시스템 ✅
│   ├── notifier.py 모듈
│   ├── 수집 성공/실패 실시간 알림
│   └── Grafana 대시보드 링크 포함
├── 2. 수집 로그 시각화 ✅
│   ├── collection_logger.py 모듈
│   ├── system_logs measurement
│   └── 별도 대시보드 (13개 패널)
├── 3. 데이터 정합성(DQ) 검증 ✅
│   ├── 누락 데이터 감지
│   ├── 이상치 감지 (±30%)
│   └── 수집 성공률 게이지
└── 4. Telegraf 시스템 모니터링 ✅
    ├── CPU/메모리/디스크/온도
    ├── 네트워크 트래픽
    └── 시스템 헬스 대시보드 (12개 패널)
```

---

## 3. 다음 단계 작업 (TODO)

### 우선순위: 높음 - Grafana 대시보드 개선

#### 3.1 수익률 비교표 (Table Panel) 📋
- **요구사항**: 10개 ETF의 기간별 수익률을 표 형태로 표시
- **기능**:
  - 기간별 열: 1년, 2년, 5년, 10년, 15년
  - CAGR (연평균 수익률) 계산
  - MDD (Maximum Drawdown, 최대낙폭)
  - Sharpe Ratio (선택)
- **구현 방안**:
  ```flux
  // 기간별 시작/종료 가격 추출
  // 수익률 계산: (현재가 - 과거가) / 과거가 * 100
  // CAGR 계산: ((종료가/시작가)^(1/기간년수) - 1) * 100
  ```
- **작업**: Table Panel + Transform (Organize fields, Join by field)

#### 3.2 상관관계 매트릭스 (Correlation Matrix) 🔥
- **요구사항**: 10개 ETF 간 상관계수 히트맵
- **기능**:
  - 10x10 매트릭스 (대각선 = 1.0)
  - 색상 코딩: +1 (강한 양의 상관) ~ -1 (강한 음의 상관)
- **구현 방안**: Python 스크립트로 사전 계산 후 InfluxDB 저장
  ```python
  # calculate_correlation.py
  # pandas .corr() 메서드로 상관계수 산출
  # InfluxDB correlation measurement에 저장
  ```
- **작업**: 스크립트 작성 → cron 등록 (매일 21:00) → Heatmap Panel

#### 3.3 패널별 시간 범위 개별 설정 ⚠️
- **현황**: Grafana UI 제한으로 수동 관리
- **해결**: Flux 쿼리에 `range()` 하드코딩 (급락장 패널 3개 적용 완료)

---

### 우선순위: 중간 - Phase 3 감성분석

#### 3.4 금융 감성 사전 구축
- **목표**: 뉴스 텍스트 → 감성 점수 (-1 ~ +1)
- **작업**:
  - [ ] 한국 금융 도메인 사전 30~50개 단어 수집
  - [ ] 긍정/부정 가중치 할당
  - [ ] `99_docs/financial_sentiment_dict.json` 저장

| 단어 | 가중치 | 카테고리 |
|------|--------|----------|
| 상승, 호조, 강세 | +1.0 | 긍정 |
| 하락, 부진, 약세 | -1.0 | 부정 |
| 급등, 폭등 | +1.5 | 강한 긍정 |
| 급락, 폭락 | -1.5 | 강한 부정 |

#### 3.5 사전 기반 감성 점수 계산
```python
def sentiment_score(text, sentiment_dict):
    tokens = tokenize(text)  # konlpy.tag.Okt()
    score = sum(sentiment_dict.get(token, 0) for token in tokens)
    return score / len(tokens)  # 정규화
```

#### 3.6 감성-주가 상관분석
- 일간 평균 감성 점수 vs 코스피 일간 수익률
- 감성 선행/후행 효과 (1일, 3일, 7일)
- 섹터별 감성 민감도 (반도체, 엔터 등)

---

### 우선순위: 낮음 - 고급 기능

#### 3.7 Grafana Alert 설정
- 코스피 일간 변동 ±5% 이상
- VIX 30 이상
- 원/달러 환율 1,400원 돌파
- 알림 채널: Telegram (기존 봇 활용)

#### 3.8 Annotation (주석) 추가
- 주요 이벤트를 차트에 수직선으로 표시
  - 2020-03: 코로나 팬데믹
  - 2022-01: 기준금리 인상 시작
  - 2024-04: 반도체 수출 회복

#### 3.9 Variables (변수) 도입
- 드롭다운으로 종목 선택
- 하나의 패널로 모든 종목 조회 가능

---

## 4. 장기 로드맵

### Phase 4: Streamlit 포트폴리오 앱 (선택)
- [ ] InfluxDB 데이터 기반 웹앱 구축
- [ ] 시스템 구조 설명 페이지 (라즈베리파이 + InfluxDB + Grafana)
- [ ] 인터랙티브 분석 기능
- [ ] 포트폴리오/구직용 웹앱

**페이지 구성 계획**:
1. 시스템 소개 - 아키텍처 다이어그램, 15년 데이터 수집 과정
2. 포트폴리오 시뮬레이션 - 종목 선택, 비중 설정, 백테스팅
3. 상관관계 분석 - 종목 간 상관 히트맵, 롤링 상관계수
4. 경제 지표 대시보드 - GDP/CPI, 환율-코스피 듀얼축
5. 뉴스 감성 분석 - 키워드별 감성 추이

### Phase 5: 고급 분석 (선택)
- [ ] 이벤트 스터디 (특정 사건 전후 분석)
- [ ] 외국인/기관 수급 데이터 추가 (KRX 크롤링)
- [ ] ML 예측 모델 (LSTM/XGBoost)

---

## 5. 데이터 소스 확장 계획

### 단기 추가 (3개월)
| 데이터 | 출처 | 용도 |
|--------|------|------|
| 암호화폐 (BTC, ETH) | Binance API | 대체 자산 상관관계 |
| 부동산 지표 | KB부동산 API | 자산시장 간 자금 이동 |
| 미국 개별주 (AAPL, NVDA 등) | yfinance | 글로벌 기술주 트렌드 |

### 중기 추가 (6개월)
| 데이터 | 출처 | 용도 |
|--------|------|------|
| 외국인/기관 매매 | KRX 크롤링 | 수급 분석 |
| 공매도 잔고 | 금융위원회 | 숏 커버링 파악 |
| 재무제표 (PER, PBR) | DART API | 밸류에이션 분석 |

---

## 6. 인프라 개선 계획

### 백업 자동화
```bash
#!/bin/bash
# 주간 백업 (일요일 02:00)
influx backup /backup/influxdb_$(date +%Y%m%d)
cp -r /var/lib/grafana /backup/grafana_$(date +%Y%m%d)
find /backup -type d -mtime +7 -exec rm -rf {} \;
```

### 성능 최적화
- InfluxDB Continuous Query (사전 집계)
- Grafana Query Caching 활성화

### Docker 컨테이너화 (선택)
- 환경 이식성, 빠른 재배포
- `docker-compose.yml` 구성 (influxdb, grafana, data-collector)

---

## 7. 현재 시스템 현황

### Grafana 대시보드 (4개, 55패널)
| 대시보드 | UID | 패널 | 용도 |
|----------|-----|------|------|
| `경제·주가_실제 데이터` | `61949380-...` | 18개 | 원본 가격 |
| `경제·주가_정규화 데이터` | `021d427b-...` | 18개 | 시작=100 정규화 |
| `수집 로그 모니터링` | `94ce2c05-...` | 13개 | 수집 현황/DQ |
| `시스템 헬스 모니터링` | `system-health-raspi5` | 12개 | CPU/메모리/온도 |

### InfluxDB 데이터 (118,312건)
| Measurement | 레코드 수 | 내용 |
|-------------|----------|------|
| stock_prices | 96,206건 | 한국 27종목 + 미국 41종목 |
| economic_indicators | 22,106건 | FRED 10개 + ECOS (CPI, GDP) |
| system_logs | - | 수집 로그 |

### 수집 종목 (76개)
- **한국**: 코스피, 코스닥, ETF 10개, 개별주 9개, 엔터/게임 7개
- **미국**: 지수 3개, ETF 38개 (나스닥, S&P500, 배당, 기술, 광범위, 인버스, 채권/금)

---

## 8. 데이터 처리 규칙

### 타임스탬프
- 모든 datetime → Asia/Seoul (KST) 통일
- 주가 리샘플: 15:30 KST 장마감 기준

### 결측치 처리
- 주말/공휴일: forward-fill + `is_holiday_gap=True` 플래그
- 실제 결측: NaN 유지, 로그 기록

### 파생 컬럼
| 컬럼 | 계산식 | 용도 |
|------|--------|------|
| log_return | `np.log(close/close.shift(1))` | 수익률 분석 |
| volatility_20d | `log_return.rolling(20).std() * sqrt(252)` | 변동성 |
| volume_zscore | `(vol-vol_ma20)/vol_std20` | 이상 거래량 탐지 |

---

## 9. 주요 결정 사항

| 날짜 | 결정 | 이유 |
|------|------|------|
| 2025-11-30 | 원본 00_data_raw/ 수정 금지 | 데이터 무결성 보장 |
| 2025-11-30 | 사전 기반 감성분석 우선 | BERT 대비 빠른 구현 |
| 2025-12-03 | InfluxDB + Grafana 도입 | 상시 모니터링 목표 |
| 2025-12-03 | CSV + InfluxDB 이중 저장 | 백업 + 시계열 분석 병행 |
| 2025-12-07 | Telegraf 시스템 모니터링 | 하드웨어 과부하 방지 |

---

## 10. 우선순위 매트릭스

```
High Impact, Low Effort (우선 실행)
├── Alert 설정 (Telegram 연동)
├── Variables 도입
└── 백업 자동화

High Impact, High Effort (계획 후 실행)
├── Phase 3 감성분석
├── Phase 4 Streamlit 앱
└── 외국인/기관 매매 데이터

Low Impact, Low Effort (시간 날 때)
├── Annotation 추가
├── 색상 테마 변경
└── 모바일 최적화

Low Impact, High Effort (후순위)
├── Docker 컨테이너화
├── 클라우드 마이그레이션
└── ML 예측 모델
```

---

## 11. 6개월 로드맵

| 월 | 목표 |
|----|------|
| 2025-12 | ✅ Phase 2.7 완료, Alert/Annotation 추가 |
| 2026-01 | Phase 3 감성분석 (사전 구축, 점수 계산) |
| 2026-02 | 감성-주가 상관 분석, 암호화폐 데이터 추가 |
| 2026-03 | Phase 4 Streamlit 앱 시작 |
| 2026-04 | Streamlit 앱 완료, 섹터별 상세 대시보드 |
| 2026-05 | GitHub 공개 준비, 프로젝트 소개 영상 |

---

## 12. 관련 문서

| 문서 | 설명 |
|------|------|
| `CLAUDE.md` | 프로젝트 지침 |
| `PRD.md` | 제품 요구사항 |
| `ARCHITECTURE.md` | 시스템 아키텍처 (Mermaid) |
| `CHANGELOG.md` | 변경 이력 |
| `DATA_SOURCE_POLICY.md` | 데이터 소스 정책 |
| `DASHBOARD_DESIGN.md` | 대시보드 설계 원칙 |

---

## 13. 업데이트 이력

- [2025-12-07] **문서 통합**: TODO.md, FUTURE_ENHANCEMENTS.md 내용 병합
- [2025-12-07] **Telegraf 시스템 모니터링 완료** - 시스템 헬스 대시보드 (12패널)
- [2025-12-07] **Telegram 알림 시스템 완료** - notifier.py 모듈
- [2025-12-07] **Phase 2.7 운영 기능 강화 완료** - 전체 4개 항목
- [2025-12-04] 수집 로그 모니터링 대시보드 분리 (13개 패널)
- [2025-12-04] Y축 정규화 완료 - 대시보드 2개 분리
- [2025-12-03] InfluxDB + Grafana 모니터링 시스템 완료

---

*최종 업데이트: 2025-12-07*
